<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forgot Password | Emotional Support Bot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='forgot.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='alert.css') }}">
</head>
<body>
  <div class="container">
    <div class="welcome-section">
      <h1>No Worries.!!</h1>
      <button class="back-btn" onclick="window.location.href='{{ url_for('login') }}'">
        Take me back.!
      </button>
    </div>

    <div class="form-container">
      <div class="circle circle1"></div>
      <div class="circle circle2"></div>
      <div class="forgot-form">
        <h2>Forgot Password?</h2>
        <p>Enter your email to receive reset instructions.</p>

        <!-- Display Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <p class="flash flash-{{ category }}">{{ message }}</p>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <!-- Updated form with CSRF token -->
        <form id="forgotPasswordForm" action="{{ url_for('forgot_password') }}" method="POST">
          {{ form.hidden_tag() }}  <!-- CSRF Token -->
          
          <input type="email" name="email" id="email" placeholder="example@mail.com" required>
          <p id="email-error"></p>
          <button type="submit" id="sendEmail">Send</button>
        </form>

        <button type="button" id="useAnotherEmail" style="display: none;">Use Another Email</button>

        <p class="signup-link">
          Don’t have an account? <a href="{{ url_for('signup') }}">Signup</a>
        </p>

        <div class="footer-links">
          <a href="#">Terms & Conditions</a> |
          <a href="#">Support</a> |
          <a href="#">Customer Care</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("forgotPasswordForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent default form submission
  
        let email = document.getElementById("email").value;
        let errorMsg = document.getElementById("email-error");
        let emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        let sendButton = document.getElementById("sendEmail");
  
        if (email.trim() === "") {
          errorMsg.textContent = "Email cannot be empty.";
          errorMsg.style.color = "red";
          return;
        }   
  
        if (!email.match(emailPattern)) {
            errorMsg.textContent = "Please enter a valid email address.";
            errorMsg.style.color = "red";
            return;
        } else {
            errorMsg.textContent = "";
        }
  
        // ✅ Debugging Message
        console.log("Submitting form with email:", email);
  
        // ✅ Let the form submit normally, now after validation
        this.submit();
    });
  </script>
  
</body>
</html>
