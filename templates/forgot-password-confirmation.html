<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forgot Password Confirmation | Emotional Support Bot</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='confirmation.css') }}">
</head>
<body>
  <div class="container">
    <!-- Flash Messages -->
    <div class="flash-messages">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
              {{ message }}
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}
    </div>

    <!-- Left side -->
    <div class="welcome-section">
      <h1>No Worries!</h1>
      <button class="back-btn" onclick="window.location.href='{{ url_for('login') }}'">
        Take me back!
      </button>
    </div>

    <!-- Right side -->
    <div class="form-container">
      <div class="circle circle1"></div>
      <div class="circle circle2"></div>
      <div class="forgot-confirm">
        <h2>Enter OTP to Proceed</h2>
        <p>We've sent a one-time password (OTP) to your email address <strong>{{ email }}</strong>.<br>
          Please enter the OTP below to reset your password.</p>

        <!-- OTP Form -->
        <form id="otpForm" method="POST" action="{{ url_for('verify_otp') }}">
          <input type="text" name="otp" id="otp" placeholder="Enter OTP" required>
          <button type="submit" class="submit-btn">Verify OTP</button>
        </form>

        <!-- Resend OTP -->
        <button class="resend-btn" id="resendBtn">Resend OTP</button>
        <p id="otpMessage"></p>

        <div class="action-buttons">
          <button class="reset-btn" id="resetBtn">Try Another Email</button>
        </div>

        <p class="signup-link">
          Donâ€™t have an account? <a href="{{ url_for('signup') }}">Signup</a>
        </p>

        <div class="footer-links">
          <a href="#">Terms & Conditions</a> |
          <a href="#">Support</a> |
          <a href="#">Customer Care</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Resend OTP functionality
    document.getElementById("resendBtn").addEventListener("click", function () {
      let email = "{{ email }}"; // Use the email passed from Flask context
      // Send a POST request to /resend-otp
      fetch("{{ url_for('resend_otp') }}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: email })
      })
      .then(response => response.json())
      .then(data => {
        document.getElementById("otpMessage").innerText = data.message || "OTP Resent!";
      })
      .catch(error => {
        console.error("Error:", error);
        document.getElementById("otpMessage").innerText = "An error occurred. Please try again.";
      });
    });

    // "Try Another Email" button functionality
    document.getElementById("resetBtn").addEventListener("click", function () {
      window.location.href = "{{ url_for('forgot_password') }}";  // Redirect to forgot password
    });
  </script>

</body>
</html>
