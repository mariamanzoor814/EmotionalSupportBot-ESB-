<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mood History</title>
    <link rel="icon" href="static/favicon.png" type="image/png">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='new.css') }}">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right,rgb(0, 0, 0),rgb(0, 0, 0));
      color: #e6e6e6;
      margin: 0;
      padding: 0;
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    
    .circle-bg {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(150, 0, 255, 0.2) 0%, rgba(150, 0, 255, 0) 70%);
      z-index: 0;
      pointer-events: none;
      
    }

    .circle {
      position: absolute;
      border-radius: 50%;
      z-index: 0;
    }
    
    .circle1 {
      width: 200px;
      height: 200px;
      background: linear-gradient(90deg, #61003A, #2D0A30);
      top: 1300px;
      left: 350px;
    }
    
    .circle2 {
      width: 200px;
      height: 200px;
      background: linear-gradient(90deg, #61003A, #2D0A30);
      top: 500px;
      right: 1300px;
    }

    .circle3 {
      width: 200px;
      height: 200px;
      background: linear-gradient(90deg, #61003A, #2D0A30);
      top: 120px;
      left: 1200px;
    }
    
    .circle4 {
      width: 200px;
      height: 200px;
      background: linear-gradient(90deg, #61003A, #2D0A30);
      bottom: 0px;
      right: 400px;
    }

    .container {
      max-width: 1000px;
      margin: 100px auto;
      padding: 2rem;
      position: relative;
      z-index: 1;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section {
      margin-bottom: 2rem;
    }

    .section h2 {
      font-size: 1.2rem;
      color: #96d6ed;
      margin-bottom: 1rem;
    }

    .summary-box, .tip-box {
      background: rgba(0, 0, 0, 0.4);
      padding: 1rem;
      border-radius: 10px;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .summary-box p, .tip-box ul {
      margin: 0.5rem 0;
    }

    .tip-box ul {
      list-style: none;
      padding-left: 1rem;
    }

    .tip-box ul li {
      margin-bottom: 0.5rem;
    }

    .tip-box ul li::before {
      content: '\f00c';
      font-family: 'Font Awesome 6 Free';
      font-weight: 900;
      color: #2cb67d;
      margin-right: 8px;
    }

    .charts {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: space-between;
    }

    .chart, .pie {
      flex: 1 1 45%;
      background: rgba(255, 255, 255, 0.04);
      padding: 1rem;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
    }

    canvas {
      width: 100%;
      height: auto;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
    }
    
    canvas.visible {
      opacity: 1;
    }

    .mood-pills {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      overflow-x: auto;
    }

    .mood-pill {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: rgba(255, 255, 255, 0.07);
      padding: 0.5rem 0.75rem;
      border-radius: 12px;
      backdrop-filter: blur(6px);
      min-width: 50px;
      text-align: center;
      font-size: 0.75rem;
    }

    .mood-pill.active {
      background: #2cb67d;
      color: #000;
      font-weight: bold;
    }

    
  </style>
</head>

<body>
 <!-- Sidebar Navigation -->
 <aside class="sidebar">
  <div class="top-section">
    <div class="logo">
      <i class="fas fa-brain" aria-hidden="true"></i>
    </div>
    <nav class="nav-icons">
      <a href="{{ url_for('dashboard') }}" title="Dashboard"><i class="fas fa-home"></i></a>
      <a href="{{ url_for('mood_trends') }}" title="Mood Analysis"><i class="fas fa-chart-bar"></i></a>
      <a href="{{ url_for('chat') }}" title="Chatbot"><i class="fas fa-comment-dots"></i></a>
      <a href="{{ url_for('calendar_page') }}" title="Mood Calendar"><i class="fas fa-calendar-alt"></i></a>
    </nav>
  </div>
  <div class="bottom-section">
    <a href="{{ url_for('settings') }}" title="Settings"><i class="fas fa-cog"></i></a>
    <a href="{{ url_for('logout') }}" title="Logout">
      <img src="https://i.pravatar.cc/100?img=12" class="avatar" alt="Logout Profile" />
    </a>
  </div>
</aside>

<main class="main-content">
  <header class="top-nav">
    <div class="logo-text">ESB</div>
    <div class="center-icons">
      <i class="fas fa-sun" id="lightModeToggle" title="Light Mode"></i>
      <i class="fas fa-moon" id="darkModeToggle" title="Dark Mode"></i>
    </div>
    <div class="right-avatar">
      <img src="https://i.pravatar.cc/100?img=12" alt="Profile Avatar" />
    </div>
  </header>

  <div class="circle-bg circle1"></div>
  <div class="circle-bg circle2"></div>
  <div class="circle-bg circle3"></div>
  <div class="circle-bg circle4"></div>

  <div class="container">
    <h1>Mood History</h1>

    <div class="section mood-pills">
      <div class="mood-pill">Mon<br><span>18</span></div>
      <div class="mood-pill">Tue<br><span>19</span></div>
      <div class="mood-pill">Wed<br><span>20</span></div>
      <div class="mood-pill">Thu<br><span>21</span></div>
      <div class="mood-pill">Fri<br><span>22</span></div>
      <div class="mood-pill">Sat<br><span>23</span></div>
      <div class="mood-pill active">Sun<br><span>24</span></div>
    </div>

    <div class="section mood-pills-header" style="display: flex; justify-content: space-between; align-items: center;">
      <h2>Mood Calendar</h2>
      <select id="calendarViewSelect" style="padding: 0.4rem; background-color: #2D0A30; color: white; border-radius: 6px;">
        <option value="weekly" selected>Weekly</option>
        <option value="monthly">Monthly</option>
      </select>
    </div>
    <div id="calendarView" class="section mood-pills">
      <!-- Pills will be dynamically injected here -->
  </div>
  
    <div class="section">
      <h2>Mood Label</h2>
      <div class="summary-box" id="moodLabelBox">
        <strong>Overall Confidence Score: 7.5/10</strong>
        <p>You’ve experienced high stress and self-doubts, but you still manage well and keep showing up. You’re trying to stay hopeful and positive despite obstacles. Your goal is pushing forward with determination.</p>
      </div>
    </div>

    <div class="section">
      <h2>Mood Summary</h2>
      <div class="summary-box" id="moodSummaryBox">
        <p>• You're feeling exhausted and stressed (mainly due to exams).</p>
        <p>• You’ve had setbacks but still manage to find energy in routines.</p>
        <p>• You feel distant from others and uncertain about the future.</p>
        <p>• Yet despite struggles, your overall mood is still fairly resilient (6/10).</p>
      </div>
    </div>

    <div class="section">
      <h2>Quick Tips to Improve</h2>
      <div class="tip-box" id="recommendationBox">
        <ul>
          <li>Break tasks into smaller steps to reduce stress.</li>
          <li>Prioritize rest and balance by using short breaks.</li>
          <li>Reach out for motivation support.</li>
          <li>Focus on small wins — build confidence.</li>
          <li>Stay present — take one step at a time.</li>
        </ul>
        <p><strong>Overall Confidence Score: 7.6/10</strong></p>
      </div>
    </div>

    <div class="section charts">
      <div class="chart">
        <h2>Mood Trends</h2>
        <canvas id="barChart"></canvas>
      </div>

      <div class="pie">
        <h2>Your Overall Mood This Week</h2>
        <canvas id="pieChart"></canvas>
      </div>
    </div>
  </div>

  <div class="chart-area section">
    <canvas id="moodChart"></canvas>
</div>
</main>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let barChartInstance = null;
  let pieChartInstance = null;

  function renderBarChart() {
    const barCtx = document.getElementById('barChart').getContext('2d');
    if (barChartInstance) {
      barChartInstance.destroy(); // clean up
    }
    barChartInstance = new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Mood Activity Log',
          data: [6, 5, 7, 4, 6, 3, 2],
          backgroundColor: '#96d6ed'
        }]
      },
      options: {
        animation: {
          duration: 1200,
          easing: 'easeOutCubic'
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 10
          }
        }
      }
    });
  }

  function renderPieChart() {
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    if (pieChartInstance) {
      pieChartInstance.destroy(); // clean up
    }
    pieChartInstance = new Chart(pieCtx, {
      type: 'doughnut',
      data: {
        labels: ['Happy', 'Stressed', 'Relaxed', 'Angry'],
        datasets: [{
          label: 'Mood Breakdown',
          data: [60, 20, 15, 5],
          backgroundColor: ['#a3f7bf', '#f76c6c', '#c7f9cc', '#ff6b6b']
        }]
      },
      options: {
        cutout: '70%',
        plugins: {
          legend: {
            position: 'bottom'
          }
        },
        animation: {
          duration: 1000,
          easing: 'easeOutBounce'
        }
      }
    });
  }

  const observerOptions = {
    threshold: 0.3
  };

  const chartObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        if (entry.target.id === 'barChart') renderBarChart();
        if (entry.target.id === 'pieChart') renderPieChart();
      } else {
        entry.target.classList.remove('visible');
      }
    });
  }, observerOptions);

  window.addEventListener('DOMContentLoaded', () => {
    const barCanvas = document.getElementById('barChart');
    const pieCanvas = document.getElementById('pieChart');
    if (barCanvas) chartObserver.observe(barCanvas);
    if (pieCanvas) chartObserver.observe(pieCanvas);
  });

  const userId = '{{ session.get("user_id") }}';

  const moodColors = {
      Happy: '#2ecc71',
      Sad: '#3498db',
      Angry: '#e74c3c',
      Neutral: '#95a5a6',
      Anxious: '#f39c12'
  };

  async function fetchMoodData() {
      const res = await fetch('/get-mood-history', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_id: userId })
      });

      const result = await res.json();
      return result.moods || [];
  }

  function generatePills(moods, view) {
      const container = document.getElementById('calendarView');
      container.innerHTML = '';

      const grouped = {};

      moods.forEach(mood => {
          const date = new Date(mood.timestamp);
          const key = view === 'weekly' ? getWeekdayName(date) : date.getDate();
          grouped[key] = mood;
      });

      for (const key in grouped) {
          const mood = grouped[key];
          const pill = document.createElement('div');
          pill.classList.add('mood-pill');
          pill.setAttribute('data-date', mood.timestamp);
          pill.style.backgroundColor = moodColors[mood.mood] || '#7f8c8d';
          pill.innerText = key;

          pill.addEventListener('click', () => displayMoodChart([mood]));
          container.appendChild(pill);
      }
  }

  function getWeekdayName(date) {
      return ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"][date.getDay()];
  }

  let chartInstance;
  function displayMoodChart(moods) {
    const mood = moods[0];

    // Inject mood label
    const moodLabel = `
        <strong>Overall Confidence Score: ${mood.confidence || 'N/A'}</strong>
        <p>${mood.label || 'No label available for this entry.'}</p>
    `;
    document.getElementById('moodLabelBox').innerHTML = moodLabel;

    // Inject mood summary
    const moodSummary = (mood.summary || []).map(line => `<p>• ${line}</p>`).join('');
    document.getElementById('moodSummaryBox').innerHTML = moodSummary || '<p>No summary available.</p>';

    // Inject recommendations
    const tipsList = (mood.tips || []).map(tip => `<li>${tip}</li>`).join('');
    const tipSection = `
        <ul>${tipsList}</ul>
        <p><strong>Overall Confidence Score: ${mood.confidence || 'N/A'}</strong></p>
    `;
    document.getElementById('recommendationBox').innerHTML = tipSection;
}


  document.getElementById('viewMode').addEventListener('change', async (e) => {
      const view = e.target.value;
      const moodData = await fetchMoodData();
      generatePills(moodData, view);
      displayMoodChart(moodData);
  });

  window.onload = async () => {
      const moodData = await fetchMoodData();
      generatePills(moodData, 'weekly');
      displayMoodChart(moodData);
  };
  
</script>

  
</body>

</html>
